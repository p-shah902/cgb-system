<div class="sidebar expanded" [ngClass]="{ 'expanded': isExpanded }">
  <div class="header">
    <div class="d-flex justify-content-between align-items-center">
      <div class="logo-text">
        <span class="logo-full">iCGB</span>
        <span class="logo-collapsed">i</span>
      </div>
      <button class="btn navbar-brand toggle px-0" (click)="handleSidebarToggle()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 5.60156H24M0 18.4016H24M0 12.0016H24" stroke="#1B202B" stroke-width="2" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>
  <div class="content">
    <ng-container *ngFor="let menuItem of menuItems">
      <ng-template
        [ngTemplateOutlet]="recursiveMenu"
        [ngTemplateOutletContext]="{ $implicit: menuItem }">
      </ng-template>
    </ng-container>

    <ng-template #recursiveMenu let-item>
      <div *ngIf="item.children?.length > 0; else singleMenu" class="link with-children" [ngClass]="{ 'active': hasActiveChild(item) || isMenuItemActive(item) }">
        <div class="content" [ngClass]="{ 'active': hasActiveChild(item) || isMenuItemActive(item) }" (click)="toggleSubmenu(item.title)">
          <div class="icon" *ngIf="item.icon" [safeHtml]="item.icon"></div>
          <div class="icon icon-placeholder" *ngIf="!item.icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.33333 2.66667H8L10.6667 5.33333V13.3333C10.6667 13.7015 10.3682 14 10 14H3.33333C2.96514 14 2.66667 13.7015 2.66667 13.3333V3.33333C2.66667 2.96514 2.96514 2.66667 3.33333 2.66667Z" stroke="#626262" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 2.66667V5.33333H10.6667" stroke="#626262" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5.33333 8.66667H10.6667M5.33333 11.3333H8" stroke="#626262" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="title">{{ item.title }}</div>
          <span class="arrow" [ngClass]="{ 'open': expandedMenus[item.title] }">
        <svg width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M14.0667 1.66797L8.00002 8.2013L1.93335 1.66797" stroke="#626262" stroke-width="1.6"
                stroke-linecap="square"/>
        </svg>
      </span>
        </div>

        <div class="children" *ngIf="expandedMenus[item.title]" (click)="$event.stopPropagation()">
          <ng-container *ngFor="let child of item.children">
            <ng-template
              [ngTemplateOutlet]="recursiveMenu"
              [ngTemplateOutletContext]="{ $implicit: child }">
            </ng-template>
          </ng-container>
        </div>
      </div>

      <ng-template #singleMenu>
        <a [routerLink]="item.path" routerLinkActive="active" [routerLinkActiveOptions]="{exact: false}" class="link" [ngClass]="{ 'active': isMenuItemActive(item) }" (click)="$event.stopPropagation()">
          <div class="content" [ngClass]="{ 'active': isMenuItemActive(item) }">
            <div class="icon" *ngIf="item.icon" [safeHtml]="item.icon"></div>
            <div class="icon icon-placeholder" *ngIf="!item.icon">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.33333 2.66667H8L10.6667 5.33333V13.3333C10.6667 13.7015 10.3682 14 10 14H3.33333C2.96514 14 2.66667 13.7015 2.66667 13.3333V3.33333C2.66667 2.96514 2.96514 2.66667 3.33333 2.66667Z" stroke="#626262" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 2.66667V5.33333H10.6667" stroke="#626262" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5.33333 8.66667H10.6667M5.33333 11.3333H8" stroke="#626262" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="title">{{ item.title }}</div>
          </div>
        </a>
      </ng-template>
    </ng-template>
  </div>
  <div class="footer"></div>
</div>
