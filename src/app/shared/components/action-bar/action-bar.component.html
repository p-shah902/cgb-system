<div class="ff-btn-list d-flex gap-3 justify-content-end">
  <!-- Create mode: show Draft/Register -->
  <ng-container
    *ngIf="!paperId || (paperId && isCopy) && (permission.canShowDraftRegisterInEdit(roleName, statusName))">
    <!-- Hide Draft button when batch paper is selected during creation -->
    <button class="btn  btn-outline-dark" type="submit" data-status="Draft" 
      *ngIf="!hasBatchPaperSelected"
      [disabled]="isLoading">
      <span *ngIf="!isLoading">Draft</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>
    <button class="btn btn-dark" type="submit" data-status="Registered" [disabled]="isLoading">
      <span *ngIf="!isLoading">Register</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>
  </ng-container>

  <!-- Edit mode -->
  <ng-container *ngIf="paperId && !isCopy">
    <!-- Draft/Register when not Registered -->
    <button class="btn  btn-outline-dark" type="submit" data-status="Draft"
      *ngIf=" permission.canShowDraftRegisterInEdit(roleName, statusName)" [disabled]="isLoading">
      <span *ngIf="!isLoading">Draft</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>
    <button class="btn btn-dark" type="submit" data-status="Registered"
      *ngIf="permission.canShowDraftRegisterInEdit(roleName, statusName)" [disabled]="isLoading">
      <span *ngIf="!isLoading">Register</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- Archive -->
    <button class="btn btn-outline-dark" type="submit" data-status="Archived"
      *ngIf="permission.canShowArchive(roleName, statusName)" [disabled]="isLoading">
      <span *ngIf="!isLoading">Archive</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- Send for PDM -->
    <button class="btn btn-primary" type="button" 
      *ngIf="permission.canShowSendForPDM(roleName, statusName)" 
      [disabled]="isLoading"
      (click)="sendForPDM.emit()">
      <span *ngIf="!isLoading">Send for PDM Approval</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- Update - General Update button using edit paper condition logic -->
    <button class="btn btn-dark" type="submit" 
      [attr.data-status]="statusName"
      *ngIf="canEditPaper() && !permission.canShowDraftRegisterInEdit(roleName, statusName) && !(roleName === 'JV Admin' && !canEditAnyJVAlignedCheckbox)"
      [disabled]="isLoading">
      <span *ngIf="!isLoading">Update</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- Update - Legacy Update button for Registered status (kept for backward compatibility) -->
    <button class="btn btn-dark" type="submit" data-status="Registered"
      *ngIf="permission.canShowUpdate(roleName, statusName) && !canEditPaper()"
      [disabled]="isLoading">
      <span *ngIf="!isLoading">Update</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- Update - Legacy Update button for On Pre-CGB (kept for backward compatibility) -->
    <button class="btn btn-dark" type="submit" data-status="On Pre-CGB"
      *ngIf="((roleName === 'Secretary' || roleName === 'Super Admin') && statusName === 'On Pre-CGB') && !canEditPaper()"
      [disabled]="isLoading">
      <span *ngIf="!isLoading">Update</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- Update - Legacy Update button for On JV Approval (kept for backward compatibility) -->
    <button class="btn btn-dark" type="submit" data-status="On JV Approval"
      *ngIf="(statusName === 'On JV Approval' && canShowUpdateForJVApproval) && !canEditPaper() && !(roleName === 'JV Admin' && !canEditAnyJVAlignedCheckbox)"
      [disabled]="isLoading">
      <span *ngIf="!isLoading">Update</span>
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
      <span *ngIf="isLoading">Loading...</span>
    </button>

    <!-- PDM actions (kept generic with outputs) -->
    <div class="d-flex align-items-center justify-content-between gap-3"
      *ngIf="roleName === 'PDM' && statusName === 'Waiting for PDM'">
      <button class="btn btn-outline-secondary" (click)="openReturn.emit($event)" [disabled]="isLoading">
        <span *ngIf="!isLoading">Return to Originator</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
      <button class="btn btn-dark" (click)="openApprove.emit($event)" [disabled]="isLoading">
        <span *ngIf="!isLoading">Approve</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
    </div>

    <!-- Add review (Pre-CGB) -->
    <div class="d-flex align-items-center justify-content-between gap-3"
      *ngIf="(roleName === 'CGB Chair' || roleName === 'CPO' || roleName === 'JV Admin' || roleName === 'Legal VP-1' || roleName === 'Performance Manager') && statusName === 'On Pre-CGB'">
      <button class="btn update-btn btn-dark" (click)="openAddReview.emit($event)" [disabled]="isLoading">
        <span *ngIf="!isLoading">Add Review</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
    </div>

    <!-- Voting (On CGB) -->
    <div class="ic-btn-div d-flex justify-content-end" [routerLink]="['/cgb-voting']"
      *ngIf="(roleName === 'CGB Chair' || roleName === 'CPO' || roleName === 'JV Admin' || roleName === 'Legal VP-1' || roleName === 'Performance Manager') && statusName === 'On CGB'">
      <button class="btn btn-outline-secondary d-flex align-items-center gap-3" [disabled]="isLoading">
        <span *ngIf="!isLoading">Vote Now</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
    </div>

    <!-- Return to requested (Action Required by CGB) -->
    <div class="ic-btn-div d-flex justify-content-end"
      *ngIf="roleName === 'Procurement Tag' && statusName === 'Action Required by CGB'">
      <button type="button" class="btn btn-outline-secondary d-flex align-items-center gap-3"
        (click)="returnToRequested.emit()" [disabled]="isLoading">
        <span *ngIf="!isLoading">Return to Requestor</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
    </div>

    <!-- Partner Approval/Rejection -->
    <div class="d-flex align-items-center justify-content-between gap-3"
      *ngIf="roleName === 'Partner' && (statusName === 'On Partner Approval 1st' || statusName === 'On Partner Approval 2nd') && canShowPartnerApproveReject">
      <button class="btn btn-outline-secondary" (click)="partnerApproveReject.emit('Rejected')" [disabled]="isLoading">
        <span *ngIf="!isLoading">Reject</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
      <button class="btn btn-dark" (click)="partnerApproveReject.emit('Approved')" [disabled]="isLoading">
        <span *ngIf="!isLoading">Approve</span>
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-1"></span>
        <span *ngIf="isLoading">Loading...</span>
      </button>
    </div>
  </ng-container>
</div>
