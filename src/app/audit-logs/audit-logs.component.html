<!-- Toasts Container -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <ngb-toast *ngFor="let toast of toastService.toasts" [class]="'bg-' + toast.type + ' text-white'" [autohide]="true"
    [delay]="5000" (hidden)="toastService.remove(toast)">
    {{ toast.message }}
  </ngb-toast>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="page-card-div">
        <div class="filter-head d-flex gap-3 mb-4">
          <div class="fh-search">
            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M16 14H15.21L14.93 13.73C15.91 12.59 16.5 11.11 16.5 9.5C16.5 5.91 13.59 3 10 3C6.41 3 3.5 5.91 3.5 9.5C3.5 13.09 6.41 16 10 16C11.61 16 13.09 15.41 14.23 14.43L14.5 14.71V15.5L19.5 20.49L20.99 19L16 14ZM10 14C7.51 14 5.5 11.99 5.5 9.5C5.5 7.01 7.51 5 10 5C12.49 5 14.5 7.01 14.5 9.5C14.5 11.99 12.49 14 10 14Z"
                fill="#84818A" />
            </svg>
            <input class="form-control" placeholder="Search Audit Logs" [(ngModel)]="searchTerm" (input)="onSearch()" />
          </div>
        </div>

        <div class="page-card-body position-relative">
          <!-- Loading Overlay -->
          <div *ngIf="isLoading" class="loading-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background-color: rgba(255, 255, 255, 0.95); z-index: 1000; min-height: 500px; border-radius: 12px;">
            <div class="table-loader">
              <div class="spinner"></div>
              <p>Loading audit logs, please wait...</p>
            </div>
          </div>
          <!-- Content - Hidden while loading -->
          <div [style.display]="isLoading ? 'none' : 'block'">
            <div class="table-responsive">
              <div class="approach-table custom-table tbl-div pb-5">
                <table class="table table-wrapper">
                  <thead>
                    <tr class="sticky">
                      <th>ID</th>
                      <th>Paper ID</th>
                      <th>Activity Type</th>
                      <th>Description</th>
                      <th>Created By</th>
                      <th>Created Date</th>
                      <th>Modified By</th>
                      <th>Modified Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let log of auditLogs; let i = index">
                      <td>{{ log.id }}</td>
                      <td>{{ log.paperId }}</td>
                      <td>
                        <span [ngClass]="getStatusClass(log.activityType)">
                          {{ log.activityType }}
                        </span>
                      </td>
                      <td>
                        <div class="paper-name">
                          <div class="paper-detail">
                            <p>{{ log.logDescription }}</p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="paper-name">
                          <div class="paper-detail">
                            <p>{{ log.createdByName }}</p>
                          </div>
                        </div>
                      </td>
                      <td class="text-nowrap">
                        {{ log.createdDate | date : "dd-MMM-yyyy HH:mm" }}
                      </td>
                      <td>
                        <div class="paper-name">
                          <div class="paper-detail">
                            <p>{{ log.modifiedByName }}</p>
                            <!-- <small class="text-muted">ID: {{ log.modifiedBy }}</small> -->
                          </div>
                        </div>
                      </td>
                      <td class="text-nowrap">
                        {{ log.modifiedDate | date : "dd-MMM-yyyy HH:mm" }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination-wrapper mt-4" *ngIf="getTotalPages() > 0">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <!-- Page Size Selector -->
            <div class="d-flex align-items-center gap-2">
              <label class="text-muted mb-0">Items per page:</label>
              <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="itemsPerPage" (change)="onPageSizeChange()">
                <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
              </select>
            </div>
            
            <!-- Pagination Info -->
            <div class="pagination-info">
              <span class="text-muted">
                Showing {{ getStartItem() }} - {{ getEndItem() }} of {{ getTotalItems() }} items
              </span>
            </div>
            
            <!-- Pagination Controls -->
            <div class="pagination-controls d-flex align-items-center gap-2">
              <button class="btn btn-outline-secondary btn-sm" 
                      (click)="prevPage()" 
                      [disabled]="currentPage === 1">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <div class="d-flex gap-1">
                <button *ngFor="let page of getPageNumbers()" 
                        class="btn btn-sm"
                        [class.btn-primary]="page === currentPage"
                        [class.btn-outline-secondary]="page !== currentPage && page !== -1"
                        [class.btn-link]="page === -1"
                        [disabled]="page === -1"
                        (click)="goToPage(page)">
                  <span *ngIf="page !== -1">{{ page }}</span>
                  <span *ngIf="page === -1">...</span>
                </button>
              </div>
              <button class="btn btn-outline-secondary btn-sm" 
                      (click)="nextPage()" 
                      [disabled]="currentPage === getTotalPages()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
